# memo

## 機械語とアセンブラ

### CPUとメモリ

- IntelやAMDのプロセッサには、64ビット整数を保持できる領域（レジスタ）が16個ある

### アセンブラとは

- ネイティブなバイナリを出力するコンパイラは、アセンブリを出力することが目標
- 機械語を直接出力するように見えても、バックグランドでアセンブラを起動している
- `objdump` コマンドでバイナリを逆アセンブルできる

### Cとそれに対応するアセンブラ

- 関数からリターンしたときにRAXに入っている値が返り値
- リターンアドレス: 呼び出した関数の終了後に戻って来るアドレス（元々実行していたアドレス）
- スタックポインタ: スタックトップを保持している記憶領域
- アセンブラでは第1引数をRDIレジスタ、第2引数をRSIレジスタに入れる
- mov命令は実際にはコピー

## 電卓レベルの言語の作成

### ステップ1：整数1個をコンパイルする言語の作成

- 用意されたDockerfile + Apple Silicon Mac + dev containerだとデフォルトでaarch64になり、tmp.sのアセンブルに失敗する
  - Dockerfileの `FROM` の直後に `--platform=linux/amd64` を追加することで強制的にx86_64のimageで起動できる
